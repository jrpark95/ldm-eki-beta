=============================================================================
LDM-EKI ì‹œê°í™” ë° í›„ì²˜ë¦¬ ë„êµ¬ ì¢…í•© ë³´ê³ ì„œ - PART 2 of 3
=============================================================================

ìƒì„± ë‚ ì§œ: 2025-10-18
ì‘ì„±ì: Claude Code Agent
ë²”ìœ„: detailed_postprocess.py, visualize_vtk.py ì™„ì „ ë¶„ì„

ëª©ì°¨:
    Part 1: compare_all_receptors.py ì™„ì „ ë¶„ì„ (1,000ì¤„)
  â†’ Part 2: detailed_postprocess.py, visualize_vtk.py ì™„ì „ ë¶„ì„ (1,000ì¤„)
    Part 3: C++ VTK ì¶œë ¥, ë””ë²„ê¹… ë„êµ¬, í†µí•© ë° ìë™í™” (1,000ì¤„)

=============================================================================
1. DETAILED_POSTPROCESS.PY ì™„ì „ ë¶„ì„
=============================================================================

1.1 ê°œìš” ë° ëª©ì 
-----------------------------------------------------------------------------

**íŒŒì¼ ìœ„ì¹˜**: util/detailed_postprocess.py
**ì´ ë¼ì¸ ìˆ˜**: 474ì¤„
**ì£¼ìš” ëª©ì **: EKI ì‹œë®¬ë ˆì´ì…˜ ì¢…ë£Œ í›„ ì„ íƒì  ìƒì„¸ ë¶„ì„ ì œê³µ

**í•µì‹¬ ê¸°ëŠ¥**:
1. NPZ ë””ë²„ê·¸ ë°ì´í„° í…ìŠ¤íŠ¸ ì¶”ì¶œ
2. ê°œë³„ ìˆ˜ìš©ì²´ í”Œë¡¯ ìƒì„±
3. ì…ë ¥ ì„¤ì • íŒŒì¼ ìš”ì•½
4. ìµœì¢… ì¢…í•© ë³´ê³ ì„œ ìƒì„±

**ì„¤ê³„ ì² í•™**:
- ìë™ ì‹¤í–‰ ì•„ë‹˜ (ì‚¬ìš©ìê°€ í•„ìš”ì‹œì—ë§Œ ì‹¤í–‰)
- compare_all_receptors.py í•¨ìˆ˜ ì¬ì‚¬ìš© (ì½”ë“œ ì¤‘ë³µ ìµœì†Œí™”)
- í…ìŠ¤íŠ¸ ê¸°ë°˜ ë°ì´í„° ì¶”ì¶œ (Excel ë“± ì™¸ë¶€ ë„êµ¬ ë¶ˆí•„ìš”)
- Markdown í˜•ì‹ ë³´ê³ ì„œ (ê°€ë…ì„± ìµœì í™”)

**ì‹¤í–‰ ë°©ë²•**:
```bash
python3 util/detailed_postprocess.py
```

**ì¶œë ¥ ë””ë ‰í† ë¦¬ êµ¬ì¡°**:
```
output/results/detailed/
â”œâ”€â”€ debug_data/          # NPZ ë°ì´í„° í…ìŠ¤íŠ¸ ì¶”ì¶œ
â”‚   â”œâ”€â”€ prior_state.txt
â”‚   â”œâ”€â”€ initial_observation.txt
â”‚   â”œâ”€â”€ iteration_0_state.txt
â”‚   â””â”€â”€ ...
â”œâ”€â”€ plots/               # ê°œë³„ ìˆ˜ìš©ì²´ í”Œë¡¯
â”‚   â”œâ”€â”€ R1_particles.png
â”‚   â”œâ”€â”€ R1_dose.png
â”‚   â”œâ”€â”€ R2_particles.png
â”‚   â”œâ”€â”€ R2_dose.png
â”‚   â””â”€â”€ emission_estimates.png
â”œâ”€â”€ config/              # ì„¤ì • ìš”ì•½
â”‚   â””â”€â”€ input_summary.md
â””â”€â”€ README.md            # ì¢…í•© ë³´ê³ ì„œ
```

1.2 í•µì‹¬ í•¨ìˆ˜ ë¶„ì„
-----------------------------------------------------------------------------

1.2.1 ensure_output_dir(subdir='detailed')
-------------------------------------------

**ëª©ì **: ì¶œë ¥ ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„±

**ì†ŒìŠ¤ ì½”ë“œ** (52-61ì¤„):
```python
def ensure_output_dir(subdir='detailed'):
    """Create output directory structure"""
    base_dir = os.path.join('output', 'results', subdir)
    subdirs = ['debug_data', 'plots', 'config']

    for sd in subdirs:
        path = os.path.join(base_dir, sd)
        os.makedirs(path, exist_ok=True)

    return base_dir
```

**ìƒì„±ë˜ëŠ” ê²½ë¡œ**:
- output/results/detailed/
- output/results/detailed/debug_data/
- output/results/detailed/plots/
- output/results/detailed/config/

**íŠ¹ì§•**:
- os.makedirs(exist_ok=True): ê¸°ì¡´ ë””ë ‰í† ë¦¬ê°€ ìˆì–´ë„ ì—ëŸ¬ ì—†ìŒ
- ìƒëŒ€ ê²½ë¡œ ì‚¬ìš©: í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰ ê°€ì •
- base_dir ë°˜í™˜: ì´í›„ í•¨ìˆ˜ë“¤ì—ì„œ ì¬ì‚¬ìš©

1.2.2 extract_debug_data(output_dir)
-------------------------------------------

**ëª©ì **: logs/debug/eki_debug_data.npzì—ì„œ ëª¨ë“  ë°°ì—´ í…ìŠ¤íŠ¸ë¡œ ì¶”ì¶œ

**ì†ŒìŠ¤ ì½”ë“œ** (64-100ì¤„):
```python
def extract_debug_data(output_dir):
    """Extract and save debug data from npz archive (text only)"""
    print("\n" + "="*70)
    print("EXTRACTING DEBUG DATA")
    print("="*70)

    data = load_debug_data()  # From eki_debug_logger.py

    if not data:
        print("âš ï¸  No debug data found in logs/debug/eki_debug_data.npz")
        return None

    debug_dir = os.path.join(output_dir, 'debug_data')

    for key, arr in data.items():
        print(f"\nğŸ“¦ Processing: {key}")
        print(f"   Shape: {arr.shape}, dtype: {arr.dtype}")

        # Save as text only (first 100 values for large arrays)
        txt_path = os.path.join(debug_dir, f'{key}.txt')
        with open(txt_path, 'w') as f:
            f.write(f"Array: {key}\n")
            f.write(f"Shape: {arr.shape}\n")
            f.write(f"dtype: {arr.dtype}\n")
            f.write(f"Min: {arr.min():.6e}\n")
            f.write(f"Max: {arr.max():.6e}\n")
            f.write(f"Mean: {arr.mean():.6e}\n")
            f.write(f"Std: {arr.std():.6e}\n")
            f.write(f"\nData (first 100 values):\n")
            flat = arr.flatten()
            for i, val in enumerate(flat[:100]):
                f.write(f"{i:6d}: {val:.12e}\n")
            if len(flat) > 100:
                f.write(f"\n... ({len(flat) - 100} more values)\n")
        print(f"   âœ“ Saved: {txt_path}")

    return data
```

**ì €ì¥ í˜•ì‹ ì˜ˆì‹œ**:
```
Array: prior_state
Shape: (24, 100)
dtype: float64
Min: 1.000000e+08
Max: 2.000000e+08
Mean: 1.500000e+08
Std: 3.162278e+07

Data (first 100 values):
     0: 1.500000000000e+08
     1: 1.450000000000e+08
     2: 1.600000000000e+08
     ...
    99: 1.550000000000e+08

... (2300 more values)
```

**í†µê³„ ì •ë³´**:
- Min/Max: ë°ì´í„° ë²”ìœ„ íŒŒì•…
- Mean: í‰ê· ê°’ (ë¬¼ë¦¬ì  íƒ€ë‹¹ì„± ê²€ì¦)
- Std: í‘œì¤€í¸ì°¨ (ì•™ìƒë¸” ë‹¤ì–‘ì„± í™•ì¸)

**ì²« 100ê°œ ê°’ë§Œ ì¶œë ¥í•˜ëŠ” ì´ìœ **:
- ëŒ€ìš©ëŸ‰ ë°°ì—´ (24Ã—100 = 2400ê°œ ê°’) ì „ì²´ ì¶œë ¥ ì‹œ íŒŒì¼ í¬ê¸° ê³¼ë‹¤
- 100ê°œ ê°’ìœ¼ë¡œ ë°ì´í„° íŒ¨í„´/ì´ìƒì¹˜ í™•ì¸ ê°€ëŠ¥
- í•„ìš”ì‹œ ì›ë³¸ NPZ íŒŒì¼ì—ì„œ ì „ì²´ ë°ì´í„° ë¡œë“œ ê°€ëŠ¥

**load_debug_data() í•¨ìˆ˜**:
- src/eki/eki_debug_logger.pyì—ì„œ import
- NPZ ì•„ì¹´ì´ë¸Œì—ì„œ ëª¨ë“  ë°°ì—´ì„ ë”•ì…”ë„ˆë¦¬ë¡œ ë¡œë“œ
- êµ¬í˜„ (eki_debug_logger.py):
```python
def load_debug_data():
    """Load debug data from NPZ archive"""
    npz_path = 'logs/debug/eki_debug_data.npz'
    if os.path.exists(npz_path):
        return dict(np.load(npz_path))
    else:
        return {}
```

1.2.3 parse_config_value(line)
-------------------------------------------

**ëª©ì **: ì„¤ì • íŒŒì¼ì—ì„œ í‚¤-ê°’ ìŒ íŒŒì‹± (ë‹¤ì–‘í•œ í˜•ì‹ ì§€ì›)

**ì†ŒìŠ¤ ì½”ë“œ** (103-109ì¤„):
```python
def parse_config_value(line):
    """Parse configuration value from line"""
    if ':' in line:
        return line.split(':', 1)[1].strip()
    elif '=' in line:
        return line.split('=', 1)[1][1].strip()
    return line.strip()
```

**ì§€ì› í˜•ì‹**:
1. ì½œë¡  êµ¬ë¶„: `KEY: value`
2. ë“±í˜¸ êµ¬ë¶„: `KEY = value` ë˜ëŠ” `KEY=value`
3. ê°’ë§Œ: `value` (í‚¤ ì—†ëŠ” ë¼ì¸)

**ì‚¬ìš© ì˜ˆì‹œ**:
```python
parse_config_value("EKI_TIME_INTERVAL: 15")      # â†’ "15"
parse_config_value("ENSEMBLE_SIZE = 100")         # â†’ "100"
parse_config_value("On")                          # â†’ "On"
```

**split(':', 1) ì„¤ëª…**:
- maxsplit=1: ì²« ë²ˆì§¸ êµ¬ë¶„ìë§Œ ë¶„í• 
- ê°’ ì•ˆì— ':'ê°€ ìˆì–´ë„ ì•ˆì „
- ì˜ˆ: `PATH: /usr/local:bin` â†’ `"/usr/local:bin"`

1.2.4 create_config_summary(output_dir)
-------------------------------------------

**ëª©ì **: ëª¨ë“  ì…ë ¥ ì„¤ì • íŒŒì¼ì—ì„œ í•µì‹¬ ê°’ë§Œ ì¶”ì¶œí•˜ì—¬ Markdown ìš”ì•½ ìƒì„±

**ì†ŒìŠ¤ ì½”ë“œ** (112-224ì¤„):
```python
def create_config_summary(output_dir):
    """Create clean configuration summary"""
    print("\n" + "="*70)
    print("GENERATING CONFIGURATION SUMMARY")
    print("="*70)

    config_dir = os.path.join(output_dir, 'config')
    summary_path = os.path.join(config_dir, 'input_summary.md')

    with open(summary_path, 'w') as f:
        f.write(f"# LDM-EKI Input Configuration Summary\n\n")
        f.write(f"**Generated:** {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
        f.write("---\n\n")

        # EKI Settings (128-145ì¤„)
        f.write("## EKI Configuration\n\n")
        try:
            with open('input/eki.conf', 'r') as cfg:
                for line in cfg:
                    line = line.strip()
                    if not line or line.startswith('#'):
                        continue
                    if 'EKI_TIME_INTERVAL' in line:
                        f.write(f"- **Time Interval:** {parse_config_value(line)} minutes\n")
                    elif 'ENSEMBLE_SIZE' in line:
                        f.write(f"- **Ensemble Size:** {parse_config_value(line)}\n")
                    elif 'ITERATION' in line and 'MAX' in line:
                        f.write(f"- **Max Iterations:** {parse_config_value(line)}\n")
                    elif 'ADAPTIVE' in line:
                        f.write(f"- **Adaptive:** {parse_config_value(line)}\n")
                    elif 'LOCALIZED' in line:
                        f.write(f"- **Localized:** {parse_config_value(line)}\n")
        except:
            f.write("*EKI configuration not found*\n")

        # Receptor Settings (148-174ì¤„)
        f.write("\n## Receptor Configuration\n\n")
        try:
            with open('input/receptor.conf', 'r') as cfg:
                for line in cfg:
                    line = line.strip()
                    if not line or line.startswith('#'):
                        continue
                    if 'NUM_RECEPTORS' in line:
                        f.write(f"- **Number of Receptors:** {parse_config_value(line)}\n")
                        break
            # Read receptor locations
            f.write("- **Receptor Locations:**\n")
            with open('input/receptor.conf', 'r') as cfg:
                in_locations = False
                for line in cfg:
                    line = line.strip()
                    if 'RECEPTOR_LOCATIONS' in line:
                        in_locations = True
                        continue
                    if in_locations and line and not line.startswith('#'):
                        if '=' in line:
                            break
                        parts = line.split()
                        if len(parts) >= 2:
                            f.write(f"  - Lat: {parts[0]}, Lon: {parts[1]}\n")
        except:
            f.write("*Receptor configuration not found*\n")

        # Source Settings (177-189ì¤„)
        f.write("\n## Source Configuration\n\n")
        try:
            with open('input/source.conf', 'r') as cfg:
                for line in cfg:
                    line = line.strip()
                    if not line or line.startswith('#'):
                        continue
                    if 'SOURCE_LOCATION' in line:
                        parts = parse_config_value(line).split()
                        if len(parts) >= 3:
                            f.write(f"- **Source Location:** Lat={parts[0]}, Lon={parts[1]}, Alt={parts[2]}m\n")
        except:
            f.write("*Source configuration not found*\n")

        # Nuclide Settings (192-204ì¤„)
        f.write("\n## Nuclide Configuration\n\n")
        try:
            with open('input/nuclides.conf', 'r') as cfg:
                for line in cfg:
                    line = line.strip()
                    if not line or line.startswith('#'):
                        continue
                    if 'PRIMARY_NUCLIDE' in line:
                        f.write(f"- **Primary Nuclide:** {parse_config_value(line)}\n")
                    elif 'DECAY_CONSTANT' in line:
                        f.write(f"- **Decay Constant:** {parse_config_value(line)} sâ»Â¹\n")
        except:
            f.write("*Nuclide configuration not found*\n")

        # Simulation Settings (207-221ì¤„)
        f.write("\n## Simulation Settings\n\n")
        try:
            with open('input/setting.txt', 'r') as cfg:
                for line in cfg:
                    line = line.strip()
                    if not line or line.startswith('#'):
                        continue
                    if 'Time_end' in line:
                        f.write(f"- **Simulation Duration:** {parse_config_value(line)} seconds\n")
                    elif 'dt' in line and 'Time' not in line:
                        f.write(f"- **Time Step:** {parse_config_value(line)} seconds\n")
                    elif 'Number_of_particles' in line:
                        f.write(f"- **Particles:** {parse_config_value(line)}\n")
        except:
            f.write("*Simulation settings not found*\n")

    print(f"âœ“ Configuration summary: {summary_path}")
    return summary_path
```

**ìƒì„±ë˜ëŠ” Markdown ì˜ˆì‹œ**:
```markdown
# LDM-EKI Input Configuration Summary

**Generated:** 2025-10-18 14:35:20

---

## EKI Configuration

- **Time Interval:** 15 minutes
- **Ensemble Size:** 100
- **Max Iterations:** 10
- **Adaptive:** On
- **Localized:** Off

## Receptor Configuration

- **Number of Receptors:** 16
- **Receptor Locations:**
  - Lat: 35.5, Lon: 129.3
  - Lat: 35.5, Lon: 129.4
  - ...

## Source Configuration

- **Source Location:** Lat=35.71, Lon=129.48, Alt=10m

## Nuclide Configuration

- **Primary Nuclide:** Cs-137
- **Decay Constant:** 7.3e-10 sâ»Â¹

## Simulation Settings

- **Simulation Duration:** 21600 seconds
- **Time Step:** 100 seconds
- **Particles:** 100000
```

**íŠ¹ì§•**:
- ëª¨ë“  ì„¤ì • íŒŒì¼ ìë™ ìŠ¤ìº”
- ì£¼ì„ ë° ë¹ˆ ì¤„ ë¬´ì‹œ
- íŒŒì¼ ì—†ì„ ì‹œ graceful fallback (*not found* ë©”ì‹œì§€)
- Markdown í˜•ì‹ (GitHub, VS Code ë“±ì—ì„œ ë°”ë¡œ ì½ê¸° ê°€ëŠ¥)

1.2.5 generate_individual_plots(output_dir)
-------------------------------------------

**ëª©ì **: compare_all_receptors.py í•¨ìˆ˜ ì¬ì‚¬ìš©í•˜ì—¬ ê°œë³„ í”Œë¡¯ ìƒì„±

**ì†ŒìŠ¤ ì½”ë“œ** (227-373ì¤„):
```python
def generate_individual_plots(output_dir):
    """Generate individual plots from original data (same as compare_all_receptors.py)"""
    print("\n" + "="*70)
    print("GENERATING INDIVIDUAL PLOTS FROM DATA")
    print("="*70)

    # Import functions from compare_all_receptors
    sys.path.insert(0, 'util')
    from compare_all_receptors import (
        load_eki_settings,
        parse_single_particle_counts,
        parse_ensemble_particle_counts,
        load_ensemble_doses_from_shm,
        load_eki_iterations,
        load_true_emissions,
        plot_emission_estimates
    )

    plots_dir = os.path.join(output_dir, 'plots')

    # Load settings
    eki_settings = load_eki_settings()
    num_receptors = eki_settings['num_receptors']
    num_timesteps = eki_settings['num_timesteps']
    time_interval = eki_settings['time_interval']

    print(f"Configuration: {num_receptors} receptors, {num_timesteps} timesteps, {time_interval}min interval")

    # Load data (256-260ì¤„)
    single_data = parse_single_particle_counts(num_receptors=num_receptors)
    ensemble_particle_data = parse_ensemble_particle_counts(num_receptors=num_receptors)
    ensemble_doses = load_ensemble_doses_from_shm()
    eki_iterations = load_eki_iterations()
    true_emissions = load_true_emissions()

    # Prepare arrays (263-275ì¤„)
    times = np.arange(1, num_timesteps + 1) * time_interval
    single_counts = [np.zeros(num_timesteps) for _ in range(num_receptors)]
    single_doses = [np.zeros(num_timesteps) for _ in range(num_receptors)]

    # Fill single mode data
    if single_data:
        for i, obs in enumerate(single_data[:num_timesteps]):
            for r in range(num_receptors):
                receptor_key = f'R{r+1}'
                if f'{receptor_key}_count' in obs:
                    single_counts[r][i] = obs[f'{receptor_key}_count']
                if f'{receptor_key}_dose' in obs:
                    single_doses[r][i] = obs[f'{receptor_key}_dose']

    # Process ensemble dose data (278-283ì¤„)
    if ensemble_doses is not None:
        ens_dose_mean = ensemble_doses.mean(axis=0)
        ens_dose_std = ensemble_doses.std(axis=0)
    else:
        ens_dose_mean = np.zeros((num_receptors, num_timesteps))
        ens_dose_std = np.zeros((num_receptors, num_timesteps))

    # Process ensemble particle data (286-295ì¤„)
    ens_counts_mean = [np.zeros(num_timesteps) for _ in range(num_receptors)]
    ens_counts_std = [np.zeros(num_timesteps) for _ in range(num_receptors)]

    for obs_idx, data in ensemble_particle_data.items():
        if obs_idx < num_timesteps:
            for r in range(num_receptors):
                receptor_key = f'R{r+1}'
                if f'{receptor_key}_count' in data and data[f'{receptor_key}_count']:
                    ens_counts_mean[r][obs_idx] = np.mean(data[f'{receptor_key}_count'])
                    ens_counts_std[r][obs_idx] = np.std(data[f'{receptor_key}_count'])

    # Colors (298-299ì¤„)
    single_color = '#2E86C1'
    ensemble_color = '#E74C3C'

    # Receptor titles (302-308ì¤„)
    receptor_titles = []
    for i in range(num_receptors):
        if i < len(eki_settings['receptor_locations']):
            lat, lon = eki_settings['receptor_locations'][i]
            receptor_titles.append(f'R{i+1} ({lat:.1f}, {lon:.1f})')
        else:
            receptor_titles.append(f'R{i+1}')

    plot_count = 0

    # Generate individual particle plots (313-334ì¤„)
    for r in range(num_receptors):
        fig, ax = plt.subplots(figsize=(8, 6))
        ax.plot(times, single_counts[r], 'o-', color=single_color,
                linewidth=2, markersize=5, label='Single Mode', alpha=0.9)
        ax.plot(times, ens_counts_mean[r], 's--', color=ensemble_color,
                linewidth=2, markersize=4, label='Ensemble Mean', alpha=0.9)
        ax.fill_between(times,
                        ens_counts_mean[r] - ens_counts_std[r],
                        ens_counts_mean[r] + ens_counts_std[r],
                        color=ensemble_color, alpha=0.2)
        ax.set_xlabel('Time (minutes)', fontsize=11)
        ax.set_ylabel('Particle Count', fontsize=11)
        ax.set_title(f'{receptor_titles[r]} PARTICLES', fontsize=12, fontweight='bold')
        ax.legend(loc='upper right', fontsize=10)
        ax.grid(True, alpha=0.3)

        plot_path = os.path.join(plots_dir, f'R{r+1}_particles.png')
        plt.tight_layout()
        plt.savefig(plot_path, dpi=200, bbox_inches='tight')
        plt.close(fig)
        print(f"âœ“ R{r+1} particles: {plot_path}")
        plot_count += 1

    # Generate individual dose plots (337-359ì¤„)
    for r in range(num_receptors):
        fig, ax = plt.subplots(figsize=(8, 6))
        ax.plot(times, single_doses[r], 'o-', color=single_color,
                linewidth=2, markersize=5, label='Single Mode', alpha=0.9)
        ax.plot(times, ens_dose_mean[r], 's--', color=ensemble_color,
                linewidth=2, markersize=4, label='Ensemble Mean', alpha=0.9)
        ax.fill_between(times,
                        ens_dose_mean[r] - ens_dose_std[r],
                        ens_dose_mean[r] + ens_dose_std[r],
                        color=ensemble_color, alpha=0.2)
        ax.set_xlabel('Time (minutes)', fontsize=11)
        ax.set_ylabel('Dose (Sv)', fontsize=11)
        ax.set_yscale('log')
        ax.set_title(f'{receptor_titles[r]} DOSE (log scale)', fontsize=12, fontweight='bold')
        ax.legend(loc='upper right', fontsize=10)
        ax.grid(True, alpha=0.3, which='both')

        plot_path = os.path.join(plots_dir, f'R{r+1}_dose.png')
        plt.tight_layout()
        plt.savefig(plot_path, dpi=200, bbox_inches='tight')
        plt.close(fig)
        print(f"âœ“ R{r+1} dose: {plot_path}")
        plot_count += 1

    # Generate emission estimates plot (362-370ì¤„)
    fig, ax = plt.subplots(figsize=(10, 6))
    plot_emission_estimates(ax, eki_iterations, true_emissions, num_timesteps, time_interval)

    plot_path = os.path.join(plots_dir, 'emission_estimates.png')
    plt.tight_layout()
    plt.savefig(plot_path, dpi=200, bbox_inches='tight')
    plt.close(fig)
    print(f"âœ“ Emission estimates: {plot_path}")
    plot_count += 1

    print(f"\nâœ“ Total plots generated: {plot_count}")
```

**ìƒì„±ë˜ëŠ” í”Œë¡¯** (16 ìˆ˜ìš©ì²´ ê¸°ì¤€):
1. R1_particles.png ~ R16_particles.png (16ê°œ)
2. R1_dose.png ~ R16_dose.png (16ê°œ)
3. emission_estimates.png (1ê°œ)
- **ì´ 33ê°œ í”Œë¡¯**

**compare_all_receptors.py ì¬ì‚¬ìš© ì´ìœ **:
- ì½”ë“œ ì¤‘ë³µ ë°©ì§€ (DRY ì›ì¹™)
- ë™ì¼í•œ ë°ì´í„° ë¡œë”©/íŒŒì‹± ë¡œì§ ì‚¬ìš©
- ì‹œê°í™” ìŠ¤íƒ€ì¼ ì¼ê´€ì„± ìœ ì§€
- ë²„ê·¸ ìˆ˜ì • ì‹œ í•œ ê³³ë§Œ ìˆ˜ì •í•˜ë©´ ë¨

**ê°œë³„ í”Œë¡¯ vs í†µí•© í”Œë¡¯ ì°¨ì´**:
- í†µí•© í”Œë¡¯ (compare_all_receptors.py): 3Ã—3 ê·¸ë¦¬ë“œ, ì—¬ëŸ¬ ìˆ˜ìš©ì²´ ë™ì‹œ ë¹„êµ
- ê°œë³„ í”Œë¡¯ (detailed_postprocess.py): ìˆ˜ìš©ì²´ë‹¹ 1ê°œ íŒŒì¼, ìƒì„¸ ë¶„ì„ ìš©ì´

**í•´ìƒë„ ì°¨ì´**:
- í†µí•© í”Œë¡¯: dpi=150
- ê°œë³„ í”Œë¡¯: dpi=200 (ë” ë†’ì€ í•´ìƒë„)

1.2.6 create_summary_report(output_dir, debug_data)
-------------------------------------------

**ëª©ì **: ìµœì¢… ì¢…í•© ë³´ê³ ì„œ (README.md) ìƒì„±

**ì†ŒìŠ¤ ì½”ë“œ** (375-427ì¤„):
```python
def create_summary_report(output_dir, debug_data):
    """Create final summary report"""
    print("\n" + "="*70)
    print("GENERATING SUMMARY REPORT")
    print("="*70)

    report_path = os.path.join(output_dir, 'README.md')

    with open(report_path, 'w') as f:
        f.write("# LDM-EKI Detailed Analysis Results\n\n")
        f.write(f"**Generated:** {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
        f.write("---\n\n")

        f.write("## Contents\n\n")
        f.write("This directory contains detailed analysis results from LDM-EKI simulation:\n\n")
        f.write("- **`config/`** - Input configuration summary\n")
        f.write("- **`debug_data/`** - Extracted debug data (text format)\n")
        f.write("- **`plots/`** - Individual receptor and emission plots\n\n")

        f.write("---\n\n")

        f.write("## Debug Data\n\n")
        if debug_data:
            f.write(f"Total arrays: {len(debug_data)}\n\n")
            f.write("| Array Name | Shape | Size (MB) |\n")
            f.write("|------------|-------|----------|\n")
            for key, arr in debug_data.items():
                size_mb = arr.nbytes / (1024 * 1024)
                f.write(f"| `{key}` | {arr.shape} | {size_mb:.2f} |\n")
            f.write("\nAll arrays saved as text files in `debug_data/` directory.\n")
        else:
            f.write("No debug data available.\n")

        f.write("\n---\n\n")

        f.write("## Plots\n\n")
        f.write("Individual plots extracted from all_receptors_comparison.png:\n\n")
        f.write("- `R1_particles.png`, `R2_particles.png`, `R3_particles.png` - Particle counts\n")
        f.write("- `R1_dose.png`, `R2_dose.png`, `R3_dose.png` - Dose observations\n")
        f.write("- `emission_estimates.png` - Emission rate estimates\n\n")

        f.write("---\n\n")
        f.write("## How to Load Debug Data\n\n")
        f.write("```python\n")
        f.write("import numpy as np\n\n")
        f.write("# Load from original NPZ archive\n")
        f.write("data = dict(np.load('logs/debug/eki_debug_data.npz'))\n")
        f.write("prior_state = data['prior_state']\n")
        f.write("initial_obs = data['initial_observation']\n")
        f.write("```\n\n")

    print(f"âœ“ Summary report: {report_path}")
    return report_path
```

**ìƒì„±ë˜ëŠ” ë³´ê³ ì„œ ì˜ˆì‹œ**:
```markdown
# LDM-EKI Detailed Analysis Results

**Generated:** 2025-10-18 14:35:25

---

## Contents

This directory contains detailed analysis results from LDM-EKI simulation:

- **`config/`** - Input configuration summary
- **`debug_data/`** - Extracted debug data (text format)
- **`plots/`** - Individual receptor and emission plots

---

## Debug Data

Total arrays: 8

| Array Name | Shape | Size (MB) |
|------------|-------|----------|
| `prior_state` | (24, 100) | 0.02 |
| `initial_observation` | (3, 24) | 0.00 |
| `iteration_0_state` | (24, 100) | 0.02 |
| `iteration_0_obs` | (3, 24, 100) | 0.05 |
| ... | ... | ... |

All arrays saved as text files in `debug_data/` directory.

---

## Plots

Individual plots extracted from all_receptors_comparison.png:

- `R1_particles.png`, `R2_particles.png`, `R3_particles.png` - Particle counts
- `R1_dose.png`, `R2_dose.png`, `R3_dose.png` - Dose observations
- `emission_estimates.png` - Emission rate estimates

---

## How to Load Debug Data

```python
import numpy as np

# Load from original NPZ archive
data = dict(np.load('logs/debug/eki_debug_data.npz'))
prior_state = data['prior_state']
initial_obs = data['initial_observation']
```
```

**ë³´ê³ ì„œ êµ¬ì„±**:
1. í—¤ë”: íƒ€ì´í‹€ + ìƒì„± ì‹œê°
2. Contents: ë””ë ‰í† ë¦¬ êµ¬ì¡° ì„¤ëª…
3. Debug Data: ë°°ì—´ ëª©ë¡ ë° í¬ê¸°
4. Plots: ìƒì„±ëœ í”Œë¡¯ ëª©ë¡
5. How to Load: Python ì½”ë“œ ì˜ˆì‹œ

1.2.7 main()
-------------------------------------------

**ëª©ì **: ì „ì²´ í›„ì²˜ë¦¬ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰

**ì†ŒìŠ¤ ì½”ë“œ** (430-473ì¤„):
```python
def main():
    """Main post-processing function"""
    print("\n" + "="*70)
    print("LDM-EKI DETAILED POST-PROCESSING")
    print("="*70)
    print(f"Timestamp: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

    # Change to project root
    script_dir = os.path.dirname(os.path.abspath(__file__))
    project_root = os.path.dirname(script_dir)
    os.chdir(project_root)
    print(f"Working directory: {os.getcwd()}")

    # Create output directory
    output_dir = ensure_output_dir('detailed')
    print(f"Output directory: {output_dir}")

    # Step 1: Extract debug data
    debug_data = extract_debug_data(output_dir)

    # Step 2: Create config summary
    create_config_summary(output_dir)

    # Step 3: Generate individual plots from data
    generate_individual_plots(output_dir)

    # Step 4: Create summary report
    summary_path = create_summary_report(output_dir, debug_data)

    # Final message
    print("\n" + "="*70)
    print("POST-PROCESSING COMPLETE!")
    print("="*70)
    print(f"\nğŸ“‚ All results saved to: {output_dir}")
    print(f"ğŸ“„ Summary report: {summary_path}")
    print("\nGenerated files:")
    print(f"  â€¢ Debug data: {output_dir}/debug_data/ (text files)")
    print(f"  â€¢ Individual plots: {output_dir}/plots/")
    print(f"  â€¢ Configuration: {output_dir}/config/")
    print("="*70 + "\n")


if __name__ == "__main__":
    main()
```

**ì‹¤í–‰ íë¦„**:
1. í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ì´ë™ (ìƒëŒ€ ê²½ë¡œ í•´ê²°)
2. ì¶œë ¥ ë””ë ‰í† ë¦¬ ìƒì„±
3. ë””ë²„ê·¸ ë°ì´í„° ì¶”ì¶œ (NPZ â†’ TXT)
4. ì„¤ì • ìš”ì•½ ìƒì„± (config íŒŒì¼ â†’ Markdown)
5. ê°œë³„ í”Œë¡¯ ìƒì„± (compare_all_receptors.py ì¬ì‚¬ìš©)
6. ì¢…í•© ë³´ê³ ì„œ ìƒì„± (README.md)
7. ìµœì¢… ë©”ì‹œì§€ ì¶œë ¥ (ìƒì„±ëœ íŒŒì¼ ê²½ë¡œ)

**ì¶œë ¥ ì˜ˆì‹œ**:
```
======================================================================
LDM-EKI DETAILED POST-PROCESSING
======================================================================
Timestamp: 2025-10-18 14:35:20
Working directory: /home/user/ldm-eki-release.v.beta
Output directory: output/results/detailed

======================================================================
EXTRACTING DEBUG DATA
======================================================================

ğŸ“¦ Processing: prior_state
   Shape: (24, 100), dtype: float64
   âœ“ Saved: output/results/detailed/debug_data/prior_state.txt

...

======================================================================
POST-PROCESSING COMPLETE!
======================================================================

ğŸ“‚ All results saved to: output/results/detailed
ğŸ“„ Summary report: output/results/detailed/README.md

Generated files:
  â€¢ Debug data: output/results/detailed/debug_data/ (text files)
  â€¢ Individual plots: output/results/detailed/plots/
  â€¢ Configuration: output/results/detailed/config/
======================================================================
```

1.3 ìë™ ì•ˆë‚´ ë©”ì‹œì§€ í†µí•©
-----------------------------------------------------------------------------

**ìœ„ì¹˜**: src/core/ldm.cu (ì‹œë®¬ë ˆì´ì…˜ ì¢…ë£Œ ì§ì „)

**êµ¬í˜„ ì½”ë“œ**:
```cpp
// ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ í›„ (ldm.cuì˜ main í•¨ìˆ˜ ë ë¶€ë¶„)
std::cout << "\n" << BRIGHT_WHITE
          << "======================================================================\n"
          << "          DETAILED POST-PROCESSING AVAILABLE\n"
          << "======================================================================\n"
          << RESET;
std::cout << "\n" << BRIGHT_CYAN << "ğŸ“Š For detailed analysis, run:\n" << RESET;
std::cout << BRIGHT_GREEN << "   python3 util/detailed_postprocess.py\n\n" << RESET;
std::cout << BRIGHT_WHITE << "This will generate:\n" << RESET;
std::cout << "  â€¢ " << BRIGHT_YELLOW << "Debug data extraction" << RESET << " (from eki_debug_data.npz)\n";
std::cout << "  â€¢ " << BRIGHT_YELLOW << "Individual receptor plots" << RESET << " (high-resolution PNG files)\n";
std::cout << "  â€¢ " << BRIGHT_YELLOW << "Configuration summary" << RESET << " (Markdown format)\n";
std::cout << "  â€¢ " << BRIGHT_YELLOW << "Comprehensive report" << RESET << " (README.md)\n\n";
std::cout << BRIGHT_WHITE
          << "======================================================================\n"
          << RESET;
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
======================================================================
          DETAILED POST-PROCESSING AVAILABLE
======================================================================

ğŸ“Š For detailed analysis, run:
   python3 util/detailed_postprocess.py

This will generate:
  â€¢ Debug data extraction (from eki_debug_data.npz)
  â€¢ Individual receptor plots (high-resolution PNG files)
  â€¢ Configuration summary (Markdown format)
  â€¢ Comprehensive report (README.md)

======================================================================
```

**ìë™ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ” ì´ìœ **:
1. ì„ íƒì  ê¸°ëŠ¥: ì‚¬ìš©ìê°€ í•„ìš”ì‹œì—ë§Œ ì‹¤í–‰
2. ì‹œê°„ ì†Œìš”: í”Œë¡¯ ìƒì„± ì‹œê°„ (16 ìˆ˜ìš©ì²´ ê¸°ì¤€ ~10ì´ˆ)
3. ë””ìŠ¤í¬ ê³µê°„: 33ê°œ PNG íŒŒì¼ + í…ìŠ¤íŠ¸ íŒŒì¼ë“¤ (~50MB)
4. ìœ ì—°ì„±: ì‚¬ìš©ìê°€ ì›í•˜ëŠ” íƒ€ì´ë°ì— ì‹¤í–‰ ê°€ëŠ¥

=============================================================================
2. VISUALIZE_VTK.PY ì™„ì „ ë¶„ì„
=============================================================================

2.1 ê°œìš” ë° ëª©ì 
-----------------------------------------------------------------------------

**íŒŒì¼ ìœ„ì¹˜**: util/visualize_vtk.py
**ì´ ë¼ì¸ ìˆ˜**: 627ì¤„
**ì£¼ìš” ëª©ì **: VTK ì…ì ë¶„í¬ ë°ì´í„°ë¥¼ ì§€ë¦¬ì  ì§€ë„ ìœ„ì— ì‹œê°í™”í•˜ê³  GIF ì• ë‹ˆë©”ì´ì…˜ ìƒì„±

**í•µì‹¬ ê¸°ëŠ¥**:
1. VTK íŒŒì¼ì—ì„œ ì…ì ìœ„ì¹˜ (lon, lat, alt) ì½ê¸°
2. Cartopy ì§€ë„ ìœ„ì— ì…ì ë¶„í¬ íˆíŠ¸ë§µ í‘œì‹œ
3. Gaussian smoothingìœ¼ë¡œ ë¶€ë“œëŸ¬ìš´ ì»¨íˆ¬ì–´ ìƒì„±
4. ì‹œê³„ì—´ VTK íŒŒì¼ë“¤ì„ GIF ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ë³€í™˜
5. ìë™ extent ê³„ì‚° (ëª¨ë“  í”„ë ˆì„ì—ì„œ ì¼ê´€ëœ ì§€ë„ ì˜ì—­)

**ì£¼ìš” ì˜ì¡´ì„±**:
- pyvista: VTK íŒŒì¼ ì½ê¸°
- cartopy: ì§€ë¦¬ì  ì§€ë„ íˆ¬ì˜
- scipy.ndimage: Gaussian smoothing
- imageio: GIF ìƒì„±
- matplotlib: ì‹œê°í™”

**Conda í™˜ê²½**:
```bash
conda activate ldm-viz
# í¬í•¨ íŒ¨í‚¤ì§€: pyvista, cartopy, scipy, imageio, matplotlib
```

**ì‹¤í–‰ ë°©ë²•**:
```bash
# ìë™ ê°ì§€ ëª¨ë“œ (prior ë˜ëŠ” ensemble ìë™ ì„ íƒ)
python3 util/visualize_vtk.py

# Prior ì‹œë®¬ë ˆì´ì…˜ (timestep 1-100, step 5)
python3 util/visualize_vtk.py --mode prior --start 1 --end 100 --step 5

# Ensemble ì‹œë®¬ë ˆì´ì…˜
python3 util/visualize_vtk.py --mode ensemble --start 1 --end 50 --step 2

# ë‹¨ì¼ VTK íŒŒì¼ í”Œë¡¯
python3 util/visualize_vtk.py --single output/plot_vtk_prior/plot_00050.vtk

# ì»¤ìŠ¤í…€ ì§€ë„ ì˜ì—­
python3 util/visualize_vtk.py --mode prior --extent 135 145 35 40

# ê°•í•œ ìŠ¤ë¬´ë”©
python3 util/visualize_vtk.py --mode prior --sigma 3.0

# ì„ í˜• ìƒ‰ìƒ ìŠ¤ì¼€ì¼
python3 util/visualize_vtk.py --mode prior --linear-scale
```

**ì¶œë ¥**:
- output/results/particle_distribution_prior.gif
- output/results/particle_distribution_ensemble.gif

2.2 í•µì‹¬ í•¨ìˆ˜ ë¶„ì„
-----------------------------------------------------------------------------

2.2.1 plot_particle_distribution()
-------------------------------------------

**ëª©ì **: ë‹¨ì¼ VTK íŒŒì¼ì„ ì§€ë¦¬ì  ì§€ë„ ìœ„ì— í”Œë¡¯

**í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜** (60-66ì¤„):
```python
def plot_particle_distribution(vtk_filename,
                               region_extent=None,
                               bins=(400, 400),
                               use_log_scale=True,
                               base_time=None,
                               dt=None,
                               sigma=2.0):
```

**íŒŒë¼ë¯¸í„° ì„¤ëª…**:
- `vtk_filename`: VTK íŒŒì¼ ê²½ë¡œ
- `region_extent`: [lon_min, lon_max, lat_min, lat_max] (Noneì´ë©´ ìë™ ê³„ì‚°)
- `bins`: íˆìŠ¤í† ê·¸ë¨ bins (ê¸°ë³¸ 400Ã—400, ê³ í•´ìƒë„)
- `use_log_scale`: ë¡œê·¸ ìƒ‰ìƒ ìŠ¤ì¼€ì¼ ì‚¬ìš© ì—¬ë¶€
- `base_time`: ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ ì‹œê° (datetime ê°ì²´)
- `dt`: íƒ€ì„ìŠ¤í… ê¸¸ì´ (ì´ˆ)
- `sigma`: Gaussian smoothing ê°•ë„ (0=ë¹„í™œì„±í™”)

**VTK íŒŒì¼ ì½ê¸°** (81-100ì¤„):
```python
try:
    mesh = pv.read(vtk_filename)
except Exception as e:
    print(f"[Error] Failed to read {vtk_filename}: {e}")
    return None

points = mesh.points

if points is None or points.size == 0:
    print(f"[Skip] {vtk_filename}: No point data.")
    return None

# Filter: valid longitude range, remove NaN/Inf
valid_lon_mask = (points[:, 0] >= 0) & (points[:, 0] < 180.0)
finite_mask = np.isfinite(points).all(axis=1)
points = points[valid_lon_mask & finite_mask]

if points.size == 0:
    print(f"[Skip] {vtk_filename}: No valid points after filtering.")
    return None

lons = points[:, 0]
lats = points[:, 1]
```

**PyVista ë™ì‘**:
- `pv.read()`: VTK íŒŒì¼ì„ UnstructuredGrid ê°ì²´ë¡œ ë¡œë“œ
- `mesh.points`: NumPy ë°°ì—´ (NÃ—3: lon, lat, alt)
- í•„í„°ë§: ìœ íš¨ ê²½ë„ ë²”ìœ„ (0-180Â°), NaN/Inf ì œê±°

**ì§€ë„ ì˜ì—­ ìë™ ê³„ì‚°** (115-141ì¤„):
```python
if region_extent is None:
    # Use actual particle extent with a small margin
    lon_min, lon_max = np.min(lons), np.max(lons)
    lat_min, lat_max = np.min(lats), np.max(lats)

    # Add 5% margin on each side
    lon_margin = (lon_max - lon_min) * 0.05
    lat_margin = (lat_max - lat_min) * 0.05
    lon_min -= lon_margin
    lon_max += lon_margin
    lat_min -= lat_margin
    lat_max += lat_margin

    # Make the extent square (equal width and height)
    lon_range = lon_max - lon_min
    lat_range = lat_max - lat_min

    if lon_range > lat_range:
        # Expand latitude to match longitude
        lat_center = (lat_min + lat_max) / 2
        lat_min = lat_center - lon_range / 2
        lat_max = lat_center + lon_range / 2
    else:
        # Expand longitude to match latitude
        lon_center = (lon_min + lon_max) / 2
        lon_min = lon_center - lat_range / 2
        lon_max = lon_center + lat_range / 2
else:
    lon_min, lon_max, lat_min, lat_max = region_extent
```

**ì •ì‚¬ê°í˜• extentì˜ ì¤‘ìš”ì„±**:
- Mercator íˆ¬ì˜ì—ì„œ ì™œê³¡ ìµœì†Œí™”
- ì§€ë„ ê°€ë¡œì„¸ë¡œ ë¹„ìœ¨ 1:1 ìœ ì§€
- ëª¨ë“  í”„ë ˆì„ì—ì„œ ì¼ê´€ëœ ìŠ¤ì¼€ì¼

**2D íˆìŠ¤í† ê·¸ë¨ ìƒì„±** (145-156ì¤„):
```python
try:
    H, lon_edges, lat_edges = np.histogram2d(
        lons, lats, bins=bins, range=[[lon_min, lon_max], [lat_min, lat_max]]
    )
except ValueError as e:
    print(f"[Skip] {vtk_filename}: histogram2d error - {e}")
    return None

lon_centers = (lon_edges[:-1] + lon_edges[1:]) / 2
lat_centers = (lat_edges[:-1] + lat_edges[1:]) / 2
Lon, Lat = np.meshgrid(lon_centers, lat_centers)

# Apply Gaussian smoothing for smoother contours
if sigma > 0:
    H = gaussian_filter(H, sigma=sigma)
```

**íˆìŠ¤í† ê·¸ë¨ ë™ì‘**:
- `np.histogram2d()`: ì…ìë¥¼ 400Ã—400 ê·¸ë¦¬ë“œì— ì§‘ê³„
- H[i, j]: (i, j) ì…€ì— ìˆëŠ” ì…ì ìˆ˜
- Gaussian smoothing: ì´ì‚° íˆìŠ¤í† ê·¸ë¨ â†’ ë¶€ë“œëŸ¬ìš´ ë¶„í¬

**Gaussian smoothing íš¨ê³¼**:
- sigma=0: ë¹„í™œì„±í™” (ë¸”ë¡ ëª¨ì–‘ íˆìŠ¤í† ê·¸ë¨)
- sigma=1: ì•½í•œ ìŠ¤ë¬´ë”©
- sigma=2: ì¤‘ê°„ ìŠ¤ë¬´ë”© (ê¸°ë³¸ê°’)
- sigma=3: ê°•í•œ ìŠ¤ë¬´ë”©

**Cartopy ì§€ë„ ìƒì„±** (161-181ì¤„):
```python
# Start plotting with square aspect ratio
fig, ax = plt.subplots(figsize=(12, 12), subplot_kw={'projection': ccrs.PlateCarree()})

# Set extent based on particle distribution (or user-specified region)
ax.set_extent([lon_min, lon_max, lat_min, lat_max], crs=ccrs.PlateCarree())

ax.add_feature(cfeature.COASTLINE, linewidth=1)
ax.add_feature(cfeature.BORDERS, linestyle=':')
ax.add_feature(cfeature.LAND, facecolor="lightgray")
ax.add_feature(cfeature.STATES, edgecolor="black", facecolor="none")
ax.add_feature(cfeature.LAKES, facecolor="lightblue")
ax.add_feature(cfeature.RIVERS, linewidth=0.5, color="blue")

gl = ax.gridlines(draw_labels=True, linestyle="--", linewidth=0.5, color="gray")
gl.xformatter = LONGITUDE_FORMATTER
gl.yformatter = LATITUDE_FORMATTER
gl.xlabel_style = {"size": 10, "color": "black"}
gl.ylabel_style = {"size": 10, "color": "black"}
gl.right_labels = False
gl.top_labels = False
```

**Cartopy ê¸°ëŠ¥**:
- `ccrs.PlateCarree()`: ì •ê±°íˆ¬ì˜ (ê²½ìœ„ë„ ì§êµ)
- `add_feature()`: í•´ì•ˆì„ , êµ­ê²½, ìœ¡ì§€, í˜¸ìˆ˜, ê°• ì¶”ê°€
- `gridlines()`: ê²©ìì„  + ê²½ìœ„ë„ ë¼ë²¨

**ì»¤ìŠ¤í…€ colormap** (182-188ì¤„):
```python
colors = [
    "#fffffc", "#c0e9fc", "#83c4f1", "#5099cf", "#49a181",
    "#6bbc51", "#69bd50", "#d3e158", "#feaf43", "#f96127",
    "#e1342a", "#9f2b2f", "#891a19"
]
cmap = mcolors.ListedColormap(colors)
```

**ìƒ‰ìƒ ë²”ìœ„**:
- í°ìƒ‰ â†’ ë°ì€ íŒŒë‘ â†’ ë…¹ìƒ‰ â†’ ë…¸ë‘ â†’ ì£¼í™© â†’ ë¹¨ê°• â†’ ì§„í•œ ë¹¨ê°•
- 13ë‹¨ê³„ ìƒ‰ìƒ (ì…ì ë°€ë„ 0 â†’ ìµœëŒ€)

**ìƒ‰ìƒ ìŠ¤ì¼€ì¼ ì„¤ì •** (191-207ì¤„):
```python
if H.max() < 1e-10:
    print(f"[Warning] {vtk_filename}: All histogram values are near zero or empty.")
    boundaries = np.linspace(0, 1, len(colors) + 1)
elif use_log_scale and H.max() > 1:
    # Use logarithmic scale, starting from 1 (10^0)
    boundaries = np.logspace(0, np.log10(H.max()), len(colors) + 1)
else:
    # Use linear scale
    boundaries = np.linspace(0, H.max(), len(colors) + 1)

# Ensure boundaries are strictly increasing
if len(np.unique(boundaries)) < len(boundaries):
    print(f"[Warning] {vtk_filename}: Boundaries not unique, using linear scale.")
    boundaries = np.linspace(H.min(), H.max() + 1e-10, len(colors) + 1)

norm = mcolors.BoundaryNorm(boundaries, ncolors=len(colors), clip=True)
```

**ë¡œê·¸ ìŠ¤ì¼€ì¼ vs ì„ í˜• ìŠ¤ì¼€ì¼**:
- ë¡œê·¸ ìŠ¤ì¼€ì¼: ë„“ì€ ë²”ìœ„ í‘œí˜„ (1 ~ 10^6 ì…ì)
- ì„ í˜• ìŠ¤ì¼€ì¼: ê· ì¼í•œ ë³€í™” í‘œí˜„

**ì»¨íˆ¬ì–´ í”Œë¡¯** (208-217ì¤„):
```python
contour = ax.contourf(
    Lon, Lat, H.T,
    levels=boundaries,
    cmap=cmap,
    norm=norm,
    transform=ccrs.PlateCarree()
)

cbar = plt.colorbar(contour, ax=ax, orientation='vertical', pad=0.02, shrink=0.8)
cbar.set_label("Particle Count", fontsize=16)
```

**H.T (ì „ì¹˜) ì´ìœ **:
- NumPy: H[lon, lat] (í–‰=ê²½ë„, ì—´=ìœ„ë„)
- contourf: H[lat, lon] (í–‰=ìœ„ë„, ì—´=ê²½ë„)
- ì „ì¹˜ë¡œ ì°¨ì› ìˆœì„œ ë§ì¶¤

**íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ì¶œ** (220-238ì¤„):
```python
# Extract timestamp from filename
# Supports patterns: plot_00001.vtk, Cs-137_00015.vtk, etc.
match = re.search(r'_(\d{5})\.vtk$', vtk_filename)
if match:
    time_step_idx = int(match.group(1))

    # Use provided base_time and dt, or defaults
    if base_time is None:
        base_time = DEFAULT_BASE_TIME
    if dt is None:
        dt = DEFAULT_DT

    time_seconds = time_step_idx * dt
    sim_time = base_time + datetime.timedelta(seconds=time_seconds)
    time_str = sim_time.strftime("%B %d, %Y, %H:%M UTC")
    particle_info = f" | Particles: {len(lons):,}"
else:
    time_str = "Unknown Time"
    particle_info = f" | Particles: {len(lons):,}"

ax.set_title(f"LDM-EKI Simulation - {time_str}{particle_info}", fontsize=18, weight='bold')
```

**íƒ€ì„ìŠ¤íƒ¬í”„ ê³„ì‚° ì˜ˆì‹œ**:
- íŒŒì¼ëª…: plot_00050.vtk
- time_step_idx: 50
- dt: 100ì´ˆ
- time_seconds: 5000ì´ˆ
- base_time: 2011-03-14 00:00:00
- sim_time: 2011-03-14 01:23:20
- ì¶œë ¥: "March 14, 2011, 01:23 UTC | Particles: 85,234"

2.2.2 create_gif_from_vtk_series()
-------------------------------------------

**ëª©ì **: ì—¬ëŸ¬ VTK íŒŒì¼ë¡œë¶€í„° ì• ë‹ˆë©”ì´ì…˜ GIF ìƒì„±

**í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜** (244-253ì¤„):
```python
def create_gif_from_vtk_series(vtk_directory,
                               filename_pattern="plot_{:05d}.vtk",
                               start=1,
                               end=100,
                               step=1,
                               output_gif="particle_distribution.gif",
                               region_extent=None,
                               base_time=None,
                               dt=None,
                               **plot_kwargs):
```

**íŒŒë¼ë¯¸í„° ì„¤ëª…**:
- `vtk_directory`: VTK íŒŒì¼ì´ ìˆëŠ” ë””ë ‰í† ë¦¬
- `filename_pattern`: íŒŒì¼ëª… íŒ¨í„´ (ì˜ˆ: "plot_{:05d}.vtk")
- `start`, `end`, `step`: íƒ€ì„ìŠ¤í… ë²”ìœ„
- `output_gif`: ì¶œë ¥ GIF íŒŒì¼ëª…
- `region_extent`: ê³ ì • ì§€ë„ ì˜ì—­ (Noneì´ë©´ ìë™ ê³„ì‚°)
- `**plot_kwargs`: plot_particle_distribution()ì— ì „ë‹¬í•  ì¶”ê°€ ì¸ì

**ì „ì—­ extent ìë™ ê³„ì‚°** (279-349ì¤„):
```python
if region_extent is None:
    print("[Info] Computing maximum extent from all VTK files...")
    lon_min_global, lon_max_global = float('inf'), float('-inf')
    lat_min_global, lat_max_global = float('inf'), float('-inf')

    for t in range(start, end + 1, step):
        vtk_filename = os.path.join(vtk_directory, filename_pattern.format(t))
        if not os.path.exists(vtk_filename):
            continue

        try:
            mesh = pv.read(vtk_filename)
            points = mesh.points
            if points is None or points.size == 0:
                continue

            # Filter valid points
            valid_lon_mask = (points[:, 0] >= 0) & (points[:, 0] < 180.0)
            finite_mask = np.isfinite(points).all(axis=1)
            points = points[valid_lon_mask & finite_mask]

            if points.size == 0:
                continue

            lons = points[:, 0]
            lats = points[:, 1]
            valid_coords = np.isfinite(lons) & np.isfinite(lats)
            lons = lons[valid_coords]
            lats = lats[valid_coords]

            if len(lons) > 0 and len(lats) > 0:
                lon_min_global = min(lon_min_global, np.min(lons))
                lon_max_global = max(lon_max_global, np.max(lons))
                lat_min_global = min(lat_min_global, np.min(lats))
                lat_max_global = max(lat_max_global, np.max(lats))

        except Exception as e:
            continue

    if lon_min_global != float('inf'):
        # Add 5% margin
        lon_margin = (lon_max_global - lon_min_global) * 0.05
        lat_margin = (lat_max_global - lat_min_global) * 0.05
        lon_min_global -= lon_margin
        lon_max_global += lon_margin
        lat_min_global -= lat_margin
        lat_max_global += lat_margin

        # Make the extent square (equal width and height)
        lon_range = lon_max_global - lon_min_global
        lat_range = lat_max_global - lat_min_global

        if lon_range > lat_range:
            # Expand latitude to match longitude
            lat_center = (lat_min_global + lat_max_global) / 2
            lat_min_global = lat_center - lon_range / 2
            lat_max_global = lat_center + lon_range / 2
        else:
            # Expand longitude to match latitude
            lon_center = (lon_min_global + lon_max_global) / 2
            lon_min_global = lon_center - lat_range / 2
            lon_max_global = lon_center + lat_range / 2

        region_extent = [lon_min_global, lon_max_global, lat_min_global, lat_max_global]
        print(f"[Info] Global extent (square): lon=[{lon_min_global:.2f}, {lon_max_global:.2f}], "
              f"lat=[{lat_min_global:.2f}, {lat_max_global:.2f}]")
        print(f"[Info] Extent size: {lon_max_global - lon_min_global:.2f}Â° Ã— {lat_max_global - lat_min_global:.2f}Â°")
    else:
        print("[Warning] Could not determine extent from VTK files, using default.")
        region_extent = DEFAULT_REGION_EXTENT

print(f"[Info] Using fixed extent for all frames: {region_extent}\n")
```

**ì „ì—­ extentì˜ í•„ìš”ì„±**:
- **ë¬¸ì œ**: ê° í”„ë ˆì„ë§ˆë‹¤ extentê°€ ë‹¤ë¥´ë©´ ì§€ë„ê°€ í™•ëŒ€/ì¶•ì†Œë˜ì–´ ì• ë‹ˆë©”ì´ì…˜ì´ ë¶ˆì•ˆì •
- **í•´ê²°**: ëª¨ë“  VTK íŒŒì¼ì„ ìŠ¤ìº”í•˜ì—¬ ìµœëŒ€ extent ê³„ì‚° í›„ ê³ ì •
- **ê²°ê³¼**: ëª¨ë“  í”„ë ˆì„ì—ì„œ ë™ì¼í•œ ì§€ë„ ì˜ì—­ ìœ ì§€

**í”„ë ˆì„ ìƒì„± ë£¨í”„** (352-378ì¤„):
```python
for t in range(start, end + 1, step):
    vtk_filename = os.path.join(vtk_directory, filename_pattern.format(t))

    if not os.path.exists(vtk_filename):
        print(f"[Skip] File not found: {vtk_filename}")
        continue

    print(f"Processing [{t:05d}]: {os.path.basename(vtk_filename)}")

    fig = plot_particle_distribution(
        vtk_filename,
        region_extent=region_extent,
        base_time=base_time,
        dt=dt,
        **plot_kwargs
    )

    if fig is None:
        continue

    # Convert figure to image
    buf = io.BytesIO()
    fig.savefig(buf, format='png', dpi=150, bbox_inches='tight')
    buf.seek(0)
    images.append(Image.open(buf).convert("RGB"))
    plt.close(fig)
```

**Figure â†’ Image ë³€í™˜**:
1. `fig.savefig(buf, format='png')`: Matplotlib Figureë¥¼ PNGë¡œ ì¸ì½”ë”©
2. `buf.seek(0)`: BytesIO ë²„í¼ í¬ì¸í„°ë¥¼ ì²˜ìŒìœ¼ë¡œ ì´ë™
3. `Image.open(buf)`: PIL Image ê°ì²´ ìƒì„±
4. `.convert("RGB")`: RGBA â†’ RGB (GIFëŠ” RGBë§Œ ì§€ì›)

**GIF ì €ì¥** (379-391ì¤„):
```python
if images:
    print(f"\n[Success] Saving GIF with {len(images)} frames...")
    images[0].save(
        output_gif,
        save_all=True,
        append_images=images[1:],
        duration=300,  # 300ms per frame
        loop=0
    )
    print(f"[Success] GIF saved as {output_gif}")
    print(f"          File size: {os.path.getsize(output_gif) / 1024 / 1024:.2f} MB")
else:
    print("[Warning] No valid frames were generated. GIF not created.")
```

**GIF íŒŒë¼ë¯¸í„°**:
- `save_all=True`: ëª¨ë“  í”„ë ˆì„ ì €ì¥
- `append_images`: ì²« í”„ë ˆì„ ì´í›„ ì¶”ê°€ í”„ë ˆì„
- `duration=300`: í”„ë ˆì„ë‹¹ 300ms (1ì´ˆì— ~3í”„ë ˆì„)
- `loop=0`: ë¬´í•œ ë°˜ë³µ

**GIF í¬ê¸° ì˜ˆì‹œ**:
- 20 í”„ë ˆì„ Ã— 400Ã—400 bins Ã— dpi=150 â†’ ~5-10 MB

2.2.3 main()
-------------------------------------------

**ëª©ì **: ëª…ë ¹ì¤„ ì¸ì íŒŒì‹± ë° ë©”ì¸ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰

**ì¸ì íŒŒì‹±** (394-506ì¤„):
```python
parser = argparse.ArgumentParser(
    description="Generate geographic visualizations from VTK files",
    formatter_class=argparse.RawDescriptionHelpFormatter,
    epilog="""
Examples:
  # Generate GIF from prior simulation (timesteps 1-100, every 5 steps)
  python3 util/visualize_vtk.py --mode prior --start 1 --end 100 --step 5

  # Generate GIF from ensemble simulation
  python3 util/visualize_vtk.py --mode ensemble --start 1 --end 50 --step 2

  # Generate single plot from specific VTK file
  python3 util/visualize_vtk.py --single output/plot_vtk_prior/plot_00050.vtk

  # Custom region extent (lon_min, lon_max, lat_min, lat_max)
  python3 util/visualize_vtk.py --mode prior --start 1 --end 100 --step 5 \\
      --extent 135 145 35 40

  # Custom output filename
  python3 util/visualize_vtk.py --mode prior --start 1 --end 100 --step 5 \\
      --output my_simulation.gif
    """
)

# Mode selection
mode_group = parser.add_mutually_exclusive_group(required=False)
mode_group.add_argument(
    '--mode',
    choices=['prior', 'ensemble'],
    help='Simulation mode: prior (true simulation) or ensemble (default: auto-detect)'
)
mode_group.add_argument(
    '--single',
    metavar='VTK_FILE',
    help='Generate single plot from specific VTK file'
)

# Time range arguments
parser.add_argument('--start', type=int, default=1, help='Starting timestep index (default: 1)')
parser.add_argument('--end', type=int, default=100, help='Ending timestep index (default: 100)')
parser.add_argument('--step', type=int, default=5, help='Step size for timesteps (default: 5)')

# Output options
parser.add_argument('--output', metavar='FILENAME', help='Output GIF filename (default: auto-generated based on mode)')
parser.add_argument('--output-dir', default='output/results', help='Output directory for GIF (default: output/results)')

# Visualization options
parser.add_argument('--extent', nargs=4, type=float, metavar=('LON_MIN', 'LON_MAX', 'LAT_MIN', 'LAT_MAX'),
                    help=f'Geographic extent (default: {DEFAULT_REGION_EXTENT})')
parser.add_argument('--bins', nargs=2, type=int, default=[400, 400], metavar=('NX', 'NY'),
                    help='Histogram bins for particle density (default: 400 400)')
parser.add_argument('--sigma', type=float, default=2.0,
                    help='Gaussian smoothing sigma for smoother contours (default: 2.0, use 0 to disable)')
parser.add_argument('--linear-scale', action='store_true',
                    help='Use linear color scale instead of logarithmic')

# Time parameters
parser.add_argument('--base-time', metavar='YYYY-MM-DD-HH:MM:SS',
                    help=f'Base simulation time (default: {DEFAULT_BASE_TIME.strftime("%Y-%m-%d %H:%M:%S")})')
parser.add_argument('--dt', type=int, default=DEFAULT_DT,
                    help=f'Time step duration in seconds (default: {DEFAULT_DT})')
```

**ì¸ì ê·¸ë£¹**:
1. **Mode selection**: --mode (prior/ensemble) ë˜ëŠ” --single (ë‹¨ì¼ íŒŒì¼)
2. **Time range**: --start, --end, --step
3. **Output**: --output, --output-dir
4. **Visualization**: --extent, --bins, --sigma, --linear-scale
5. **Time parameters**: --base-time, --dt

**ìë™ ëª¨ë“œ ê°ì§€** (521-541ì¤„):
```python
if not args.mode and not args.single:
    print("[Info] No mode specified, auto-detecting available VTK files...\n")

    # Check which directories exist and have VTK files
    prior_dir = 'output/plot_vtk_prior'
    ensemble_dir = 'output/plot_vtk_ens'

    prior_exists = os.path.exists(prior_dir) and len([f for f in os.listdir(prior_dir) if f.endswith('.vtk')]) > 0
    ensemble_exists = os.path.exists(ensemble_dir) and len([f for f in os.listdir(ensemble_dir) if f.endswith('.vtk')]) > 0

    if prior_exists:
        args.mode = 'prior'
        print(f"[Info] Found VTK files in {prior_dir}, using mode: prior")
    elif ensemble_exists:
        args.mode = 'ensemble'
        print(f"[Info] Found VTK files in {ensemble_dir}, using mode: ensemble")
    else:
        print("[Error] No VTK files found in output/plot_vtk_prior or output/plot_vtk_ens")
        print("        Run a simulation first or specify --single with a VTK file path.")
        sys.exit(1)
```

**ìš°ì„ ìˆœìœ„**: prior > ensemble
- ë‘ ë””ë ‰í† ë¦¬ ëª¨ë‘ ìˆìœ¼ë©´ prior ì„ íƒ
- ì‚¬ìš©ìê°€ ì›í•˜ë©´ --mode ensembleë¡œ ëª…ì‹œ ê°€ëŠ¥

**ë‹¨ì¼ í”Œë¡¯ ëª¨ë“œ** (544-568ì¤„):
```python
if args.single:
    if not os.path.exists(args.single):
        print(f"[Error] File not found: {args.single}")
        sys.exit(1)

    print(f"Generating single plot from: {args.single}")
    fig = plot_particle_distribution(
        args.single,
        region_extent=region_extent,
        bins=tuple(args.bins),
        use_log_scale=not args.linear_scale,
        base_time=base_time,
        dt=args.dt,
        sigma=args.sigma
    )

    if fig is not None:
        output_png = args.single.replace('.vtk', '_plot.png')
        fig.savefig(output_png, dpi=150, bbox_inches='tight')
        print(f"[Success] Plot saved as {output_png}")
        plt.show()
    else:
        print("[Error] Failed to generate plot")
        sys.exit(1)
    return
```

**ë‹¨ì¼ í”Œë¡¯ ì¶œë ¥**:
- VTK íŒŒì¼ê³¼ ë™ì¼í•œ ìœ„ì¹˜ì— PNG ì €ì¥
- ì˜ˆ: `plot_00050.vtk` â†’ `plot_00050_plot.png`
- `plt.show()`: ê·¸ë˜í”„ ì°½ í‘œì‹œ (ëŒ€í™”í˜• ëª¨ë“œ)

**ìë™ end timestep ê°ì§€** (584-599ì¤„):
```python
if args.end == 100:  # default value
    # Find the maximum timestep from existing VTK files
    vtk_files = [f for f in os.listdir(vtk_directory) if f.endswith('.vtk')]
    if vtk_files:
        # Extract timestep numbers from filenames (e.g., plot_00050.vtk -> 50)
        timesteps = []
        for f in vtk_files:
            match = re.search(r'_(\d{5})\.vtk$', f)
            if match:
                timesteps.append(int(match.group(1)))

        if timesteps:
            detected_end = max(timesteps)
            print(f"[Info] Auto-detected end timestep: {detected_end} (found {len(timesteps)} VTK files)")
            args.end = detected_end
```

**ìë™ ê°ì§€ ì´ìœ **:
- ì‚¬ìš©ìê°€ --endë¥¼ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ 100 ì‚¬ìš©
- ì‹¤ì œ VTK íŒŒì¼ì´ 100ê°œ ë¯¸ë§Œì´ë©´ ë¶ˆí•„ìš”í•œ ê²½ê³  ë©”ì‹œì§€ ë°œìƒ
- ë””ë ‰í† ë¦¬ì—ì„œ ìµœëŒ€ íƒ€ì„ìŠ¤í… ìë™ ê°ì§€í•˜ì—¬ end ì—…ë°ì´íŠ¸

**GIF ìƒì„± ëª¨ë“œ** (609-622ì¤„):
```python
# Prepare output path
output_gif = args.output if args.output else default_output
if not output_gif.endswith('.gif'):
    output_gif += '.gif'

os.makedirs(args.output_dir, exist_ok=True)
output_gif = os.path.join(args.output_dir, output_gif)

# Generate GIF
create_gif_from_vtk_series(
    vtk_directory=vtk_directory,
    filename_pattern="plot_{:05d}.vtk",
    start=args.start,
    end=args.end,
    step=args.step,
    output_gif=output_gif,
    region_extent=region_extent,
    bins=tuple(args.bins),
    use_log_scale=not args.linear_scale,
    base_time=base_time,
    dt=args.dt,
    sigma=args.sigma
)
```

2.3 ì‚¬ìš© ì˜ˆì‹œ ë° ì¶œë ¥
-----------------------------------------------------------------------------

2.3.1 ìë™ ëª¨ë“œ (ê¸°ë³¸)
-------------------------------------------

**ëª…ë ¹ì–´**:
```bash
python3 util/visualize_vtk.py
```

**ì¶œë ¥**:
```
[Info] No mode specified, auto-detecting available VTK files...

[Info] Found VTK files in output/plot_vtk_prior, using mode: prior

======================================================================
Generating GIF from VTK files:
  Directory: output/plot_vtk_prior
  Range: 1 to 216 (step 5)
  Output: output/results/particle_distribution_prior.gif
======================================================================

[Info] Computing maximum extent from all VTK files...
[Info] Global extent (square): lon=[129.20, 129.76], lat=[35.42, 35.98]
[Info] Extent size: 0.56Â° Ã— 0.56Â°
[Info] Using fixed extent for all frames: [129.20, 129.76, 35.42, 35.98]

Processing [00001]: plot_00001.vtk
Processing [00006]: plot_00006.vtk
Processing [00011]: plot_00011.vtk
...
Processing [00216]: plot_00216.vtk

[Success] Saving GIF with 44 frames...
[Success] GIF saved as output/results/particle_distribution_prior.gif
          File size: 8.35 MB
```

2.3.2 Prior ëª¨ë“œ (ì»¤ìŠ¤í…€ ë²”ìœ„)
-------------------------------------------

**ëª…ë ¹ì–´**:
```bash
python3 util/visualize_vtk.py --mode prior --start 1 --end 100 --step 10
```

**ì¶œë ¥**:
- íƒ€ì„ìŠ¤í… 1, 11, 21, ..., 91 (10ê°œ í”„ë ˆì„)
- output/results/particle_distribution_prior.gif

2.3.3 Ensemble ëª¨ë“œ
-------------------------------------------

**ëª…ë ¹ì–´**:
```bash
python3 util/visualize_vtk.py --mode ensemble --start 1 --end 50 --step 2
```

**ë””ë ‰í† ë¦¬**: output/plot_vtk_ens/
**ì¶œë ¥**: output/results/particle_distribution_ensemble.gif

2.3.4 ë‹¨ì¼ í”Œë¡¯ ëª¨ë“œ
-------------------------------------------

**ëª…ë ¹ì–´**:
```bash
python3 util/visualize_vtk.py --single output/plot_vtk_prior/plot_00100.vtk
```

**ì¶œë ¥**:
- PNG: output/plot_vtk_prior/plot_00100_plot.png
- ê·¸ë˜í”„ ì°½ í‘œì‹œ (ëŒ€í™”í˜• ëª¨ë“œ)

2.3.5 ì»¤ìŠ¤í…€ ì§€ë„ ì˜ì—­
-------------------------------------------

**ëª…ë ¹ì–´**:
```bash
python3 util/visualize_vtk.py --mode prior --extent 135 145 35 40
```

**íš¨ê³¼**:
- ê³ ì • extent: 135-145Â°E, 35-40Â°N
- ìë™ ê³„ì‚° ë¹„í™œì„±í™”

2.3.6 ê°•í•œ ìŠ¤ë¬´ë”©
-------------------------------------------

**ëª…ë ¹ì–´**:
```bash
python3 util/visualize_vtk.py --mode prior --sigma 3.0
```

**íš¨ê³¼**:
- Gaussian smoothing ê°•ë„ ì¦ê°€
- ë” ë¶€ë“œëŸ¬ìš´ ì»¨íˆ¬ì–´

2.3.7 ì„ í˜• ìƒ‰ìƒ ìŠ¤ì¼€ì¼
-------------------------------------------

**ëª…ë ¹ì–´**:
```bash
python3 util/visualize_vtk.py --mode prior --linear-scale
```

**íš¨ê³¼**:
- ë¡œê·¸ ìŠ¤ì¼€ì¼ ë¹„í™œì„±í™”
- ì„ í˜• ìƒ‰ìƒ ë¶„í¬

2.4 Conda í™˜ê²½ ì„¤ì •
-----------------------------------------------------------------------------

**í™˜ê²½ ìƒì„±**:
```bash
conda create -n ldm-viz python=3.9
conda activate ldm-viz
```

**íŒ¨í‚¤ì§€ ì„¤ì¹˜**:
```bash
conda install -c conda-forge pyvista
conda install -c conda-forge cartopy
conda install scipy
conda install imageio
conda install matplotlib
```

**ë˜ëŠ” í•œ ë²ˆì—**:
```bash
conda install -c conda-forge pyvista cartopy scipy imageio matplotlib
```

**í™˜ê²½ ë‚´ë³´ë‚´ê¸°**:
```bash
conda env export > environment_viz.yml
```

**í™˜ê²½ ë³µì›**:
```bash
conda env create -f environment_viz.yml
```

2.5 ì„±ëŠ¥ ìµœì í™”
-----------------------------------------------------------------------------

2.5.1 ë©”ëª¨ë¦¬ ìµœì í™”
-------------------------------------------

**ë¬¸ì œ**: ëŒ€ìš©ëŸ‰ VTK íŒŒì¼ (100ë§Œ ì…ì Ã— 100 í”„ë ˆì„ = 1.2GB ë©”ëª¨ë¦¬)

**í•´ê²°**:
1. **í”„ë ˆì„ë³„ ì²˜ë¦¬**: ëª¨ë“  í”„ë ˆì„ì„ ë©”ëª¨ë¦¬ì— ë¡œë“œí•˜ì§€ ì•Šê³  í•˜ë‚˜ì”© ì²˜ë¦¬
2. **Figure ëª…ì‹œì  ë‹«ê¸°**: `plt.close(fig)` í˜¸ì¶œë¡œ ë©”ëª¨ë¦¬ í•´ì œ
3. **BytesIO ì‚¬ìš©**: ë””ìŠ¤í¬ I/O ì—†ì´ ë©”ëª¨ë¦¬ì—ì„œ PNG ì¸ì½”ë”©

**ì½”ë“œ ì˜ˆì‹œ**:
```python
for t in range(start, end + 1, step):
    fig = plot_particle_distribution(...)

    # Figure â†’ BytesIO â†’ PIL Image (ë””ìŠ¤í¬ I/O ì—†ìŒ)
    buf = io.BytesIO()
    fig.savefig(buf, format='png', dpi=150)
    buf.seek(0)
    images.append(Image.open(buf).convert("RGB"))

    # Figure ëª…ì‹œì  ë‹«ê¸° (ë©”ëª¨ë¦¬ í•´ì œ)
    plt.close(fig)
```

2.5.2 ê³„ì‚° ìµœì í™”
-------------------------------------------

**ì „ì—­ extent 1íšŒ ê³„ì‚°**:
- ëª¨ë“  VTK íŒŒì¼ ìŠ¤ìº” (O(N) where N=í”„ë ˆì„ ìˆ˜)
- ê° í”„ë ˆì„ì—ì„œ extent ì¬ê³„ì‚° ì•ˆ í•¨

**Gaussian smoothing ìºì‹±**:
- scipy.ndimage.gaussian_filter()ëŠ” ì¶©ë¶„íˆ ë¹ ë¦„
- ì¶”ê°€ ìºì‹± ë¶ˆí•„ìš”

**íˆìŠ¤í† ê·¸ë¨ bins ì¡°ì ˆ**:
- 400Ã—400 (ê¸°ë³¸): ê³ í•´ìƒë„, ì•½ê°„ ëŠë¦¼
- 200Ã—200: ë¹ ë¦„, ì¤‘ê°„ í•´ìƒë„
- 600Ã—600: ë§¤ìš° ê³ í•´ìƒë„, ëŠë¦¼

**ì‚¬ìš© ì˜ˆì‹œ**:
```bash
# ë¹ ë¥¸ ë¯¸ë¦¬ë³´ê¸°
python3 util/visualize_vtk.py --bins 200 200 --step 10

# ìµœì¢… ê³ í’ˆì§ˆ
python3 util/visualize_vtk.py --bins 600 600 --step 1
```

2.5.3 ë””ìŠ¤í¬ ìµœì í™”
-------------------------------------------

**GIF ì••ì¶•**:
- Pillow ê¸°ë³¸ ì••ì¶• ì‚¬ìš©
- ì¶”ê°€ ì••ì¶• ë„êµ¬: gifsicle

**ëª…ë ¹ì–´**:
```bash
# GIF í¬ê¸° ì¤„ì´ê¸° (gifsicle ì„¤ì¹˜ í•„ìš”)
gifsicle -O3 --colors 256 input.gif -o output.gif
```

**í”„ë ˆì„ ê°„ê²© ì¡°ì ˆ**:
```python
# ë” ë¹ ë¥¸ ì• ë‹ˆë©”ì´ì…˜ (ë” ì‘ì€ íŒŒì¼)
images[0].save(output_gif, save_all=True, append_images=images[1:],
               duration=200, loop=0)  # 200ms

# ë” ëŠë¦° ì• ë‹ˆë©”ì´ì…˜ (ë” í° íŒŒì¼)
images[0].save(output_gif, save_all=True, append_images=images[1:],
               duration=500, loop=0)  # 500ms
```

=============================================================================
3. ë„êµ¬ ê°„ í†µí•© ë° ì›Œí¬í”Œë¡œìš°
=============================================================================

3.1 ì „ì²´ ì›Œí¬í”Œë¡œìš°
-----------------------------------------------------------------------------

**ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰ â†’ ìë™ ì‹œê°í™” â†’ ì„ íƒì  í›„ì²˜ë¦¬**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SIMULATION (./ldm-eki)                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ EKI ìµœì í™” ì‹¤í–‰                                                â”‚
â”‚ â€¢ VTK íŒŒì¼ ìë™ ìƒì„± (output/plot_vtk_prior/, plot_vtk_ens/)   â”‚
â”‚ â€¢ ë””ë²„ê·¸ ë°ì´í„° ì €ì¥ (logs/debug/eki_debug_data.npz)           â”‚
â”‚ â€¢ ë¡œê·¸ íŒŒì¼ ì €ì¥ (logs/ldm_eki_simulation.log)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. AUTO VISUALIZATION (ìë™ ì‹¤í–‰)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ compare_all_receptors.py ì‹¤í–‰                                 â”‚
â”‚ â€¢ í†µí•© í”Œë¡¯ ìƒì„± (all_receptors_comparison.png)                 â”‚
â”‚ â€¢ ìˆ˜ìš©ì²´ë³„ ì…ì/ì„ ëŸ‰ ë¹„êµ + ë°©ì¶œëŸ‰ ì¶”ì •                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. OPTIONAL POST-PROCESSING (ì‚¬ìš©ì ì„ íƒ)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A. detailed_postprocess.py                                      â”‚
â”‚    â€¢ NPZ ë°ì´í„° í…ìŠ¤íŠ¸ ì¶”ì¶œ                                      â”‚
â”‚    â€¢ ê°œë³„ ìˆ˜ìš©ì²´ í”Œë¡¯ ìƒì„± (dpi=200)                             â”‚
â”‚    â€¢ ì„¤ì • ìš”ì•½ Markdown ìƒì„±                                     â”‚
â”‚    â€¢ ì¢…í•© ë³´ê³ ì„œ (README.md)                                    â”‚
â”‚                                                                 â”‚
â”‚ B. visualize_vtk.py                                             â”‚
â”‚    â€¢ VTK ì…ì ë¶„í¬ ì§€ë„ ì‹œê°í™”                                   â”‚
â”‚    â€¢ GIF ì• ë‹ˆë©”ì´ì…˜ ìƒì„±                                         â”‚
â”‚    â€¢ Cartopy ì§€ë¦¬ì  í”Œë¡¯                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

3.2 ë„êµ¬ë³„ ì—­í•  ë¶„ë‹´
-----------------------------------------------------------------------------

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ compare_all_receptors.py - ë©”ì¸ ì‹œê°í™” ë„êµ¬                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ìë™ ì‹¤í–‰ (ì‹œë®¬ë ˆì´ì…˜ ì¢…ë£Œ ì§í›„)                                â”‚
â”‚ â€¢ ë¹ ë¥¸ ê²°ê³¼ í™•ì¸ (í†µí•© í”Œë¡¯ 1ê°œ)                                  â”‚
â”‚ â€¢ ìˆ˜ìš©ì²´ ë¹„êµ ì¤‘ì‹¬                                                â”‚
â”‚ â€¢ 3Ã—3 ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ (3 ìˆ˜ìš©ì²´ Ã— 3 í”Œë¡¯)                        â”‚
â”‚ â€¢ dpi=150 (ë¹ ë¥¸ ìƒì„±)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ detailed_postprocess.py - ìƒì„¸ ë¶„ì„ ë„êµ¬                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ì„ íƒì  ì‹¤í–‰ (ì‚¬ìš©ìê°€ í•„ìš”ì‹œ)                                   â”‚
â”‚ â€¢ ê¹Šì´ ìˆëŠ” ë¶„ì„ (ë””ë²„ê·¸ ë°ì´í„° ì¶”ì¶œ)                             â”‚
â”‚ â€¢ ê°œë³„ í”Œë¡¯ (ìˆ˜ìš©ì²´ë‹¹ ë³„ë„ íŒŒì¼)                                  â”‚
â”‚ â€¢ ì„¤ì • ìš”ì•½ (Markdown)                                           â”‚
â”‚ â€¢ dpi=200 (ê³ í•´ìƒë„)                                             â”‚
â”‚ â€¢ compare_all_receptors.py í•¨ìˆ˜ ì¬ì‚¬ìš©                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ visualize_vtk.py - ì§€ë¦¬ì  ì‹œê°í™” ë„êµ¬                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ì„ íƒì  ì‹¤í–‰ (ì‚¬ìš©ìê°€ í•„ìš”ì‹œ)                                   â”‚
â”‚ â€¢ ê³µê°„ ë¶„í¬ ì‹œê°í™” (ì§€ë„ ìœ„ ì…ì)                                 â”‚
â”‚ â€¢ GIF ì• ë‹ˆë©”ì´ì…˜ (ì‹œê°„ ì§„í™”)                                     â”‚
â”‚ â€¢ Cartopy ì „ë¬¸ ê¸°ëŠ¥ (ì§€ë¦¬ì  íˆ¬ì˜)                                 â”‚
â”‚ â€¢ PyVista VTK ë¡œë”©                                               â”‚
â”‚ â€¢ Conda í™˜ê²½ í•„ìš” (ldm-viz)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3.3 ì¶œë ¥ íŒŒì¼ êµ¬ì¡°
-----------------------------------------------------------------------------

```
output/
â”œâ”€â”€ plot_vtk_prior/              # VTK íŒŒì¼ (ì°¸ê°’ ì‹œë®¬ë ˆì´ì…˜)
â”‚   â”œâ”€â”€ plot_00001.vtk
â”‚   â”œâ”€â”€ plot_00002.vtk
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ plot_vtk_ens/                # VTK íŒŒì¼ (ì•™ìƒë¸” ìµœì¢… ë°˜ë³µ)
â”‚   â”œâ”€â”€ plot_00001.vtk
â”‚   â”œâ”€â”€ plot_00002.vtk
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ results/
    â”œâ”€â”€ all_receptors_comparison.png          # í†µí•© í”Œë¡¯ (ìë™ ìƒì„±)
    â”‚
    â”œâ”€â”€ particle_distribution_prior.gif       # Prior GIF (ì„ íƒ)
    â”œâ”€â”€ particle_distribution_ensemble.gif    # Ensemble GIF (ì„ íƒ)
    â”‚
    â””â”€â”€ detailed/                             # ìƒì„¸ ë¶„ì„ (ì„ íƒ)
        â”œâ”€â”€ README.md                         # ì¢…í•© ë³´ê³ ì„œ
        â”œâ”€â”€ config/
        â”‚   â””â”€â”€ input_summary.md              # ì„¤ì • ìš”ì•½
        â”œâ”€â”€ debug_data/
        â”‚   â”œâ”€â”€ prior_state.txt
        â”‚   â”œâ”€â”€ initial_observation.txt
        â”‚   â””â”€â”€ ...
        â””â”€â”€ plots/
            â”œâ”€â”€ R1_particles.png
            â”œâ”€â”€ R1_dose.png
            â”œâ”€â”€ R2_particles.png
            â”œâ”€â”€ R2_dose.png
            â””â”€â”€ emission_estimates.png

logs/
â”œâ”€â”€ ldm_eki_simulation.log       # ë©”ì¸ ë¡œê·¸
â”œâ”€â”€ python_eki_output.log         # Python EKI ë¡œê·¸
â”œâ”€â”€ debug/
â”‚   â””â”€â”€ eki_debug_data.npz        # ë””ë²„ê·¸ ë°ì´í„° (NPZ)
â””â”€â”€ eki_iterations/
    â”œâ”€â”€ iteration_0.npy
    â”œâ”€â”€ iteration_1.npy
    â””â”€â”€ ...
```

3.4 ì‚¬ìš©ì ê°€ì´ë“œ
-----------------------------------------------------------------------------

**ê¸°ë³¸ ì‚¬ìš© (ëŒ€ë¶€ë¶„ì˜ ê²½ìš°)**:
```bash
# 1. ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
./ldm-eki

# 2. ìë™ ìƒì„±ëœ í”Œë¡¯ í™•ì¸
xdg-open output/results/all_receptors_comparison.png  # Linux
open output/results/all_receptors_comparison.png      # macOS
```

**ìƒì„¸ ë¶„ì„ì´ í•„ìš”í•œ ê²½ìš°**:
```bash
# 3. í›„ì²˜ë¦¬ ì‹¤í–‰
python3 util/detailed_postprocess.py

# 4. ìƒì„±ëœ íŒŒì¼ í™•ì¸
ls output/results/detailed/
cat output/results/detailed/README.md
```

**ì§€ë¦¬ì  ì‹œê°í™”ê°€ í•„ìš”í•œ ê²½ìš°**:
```bash
# 5. Conda í™˜ê²½ í™œì„±í™”
conda activate ldm-viz

# 6. VTK ì‹œê°í™” ì‹¤í–‰
python3 util/visualize_vtk.py

# 7. GIF í™•ì¸
xdg-open output/results/particle_distribution_prior.gif
```

**ê³ ê¸‰ ì‚¬ìš© (ì»¤ìŠ¤í„°ë§ˆì´ì§•)**:
```bash
# íŠ¹ì • íƒ€ì„ìŠ¤í…ë§Œ ì• ë‹ˆë©”ì´ì…˜
python3 util/visualize_vtk.py --start 50 --end 150 --step 5

# ê°•í•œ ìŠ¤ë¬´ë”© + ì„ í˜• ìŠ¤ì¼€ì¼
python3 util/visualize_vtk.py --sigma 3.0 --linear-scale

# ì»¤ìŠ¤í…€ ì§€ë„ ì˜ì—­
python3 util/visualize_vtk.py --extent 128 131 34 37
```

=============================================================================
4. ê²°ë¡  ë° ìš”ì•½
=============================================================================

4.1 Part 2 ìš”ì•½
-----------------------------------------------------------------------------

**ë‹¤ë£¬ ë‚´ìš©**:
1. **detailed_postprocess.py** (450ì¤„ ë¶„ì„)
   - NPZ ë””ë²„ê·¸ ë°ì´í„° í…ìŠ¤íŠ¸ ì¶”ì¶œ
   - ê°œë³„ ìˆ˜ìš©ì²´ í”Œë¡¯ ìƒì„± (ê³ í•´ìƒë„)
   - ì„¤ì • íŒŒì¼ ìš”ì•½ (Markdown)
   - ì¢…í•© ë³´ê³ ì„œ (README.md)
   - compare_all_receptors.py í•¨ìˆ˜ ì¬ì‚¬ìš©

2. **visualize_vtk.py** (550ì¤„ ë¶„ì„)
   - VTK íŒŒì¼ ì½ê¸° (PyVista)
   - Cartopy ì§€ë¦¬ì  ì§€ë„ ì‹œê°í™”
   - 2D íˆìŠ¤í† ê·¸ë¨ + Gaussian smoothing
   - ì „ì—­ extent ìë™ ê³„ì‚°
   - GIF ì• ë‹ˆë©”ì´ì…˜ ìƒì„±
   - ëª…ë ¹ì¤„ ì¸ì íŒŒì‹±

**ì£¼ìš” ì„¤ê³„ íŒ¨í„´**:
- **ì½”ë“œ ì¬ì‚¬ìš©**: detailed_postprocess.pyê°€ compare_all_receptors.py í•¨ìˆ˜ import
- **ìë™ ê°ì§€**: ëª¨ë“œ/extent/end timestep ìë™ ê°ì§€
- **ìœ ì—°ì„±**: í’ë¶€í•œ ëª…ë ¹ì¤„ ì˜µì…˜
- **Fail-safe**: íŒŒì¼ ì—†ì„ ì‹œ graceful fallback

**ì„±ëŠ¥ ìµœì í™”**:
- í”„ë ˆì„ë³„ ë©”ëª¨ë¦¬ í•´ì œ (plt.close)
- BytesIO ì‚¬ìš© (ë””ìŠ¤í¬ I/O ìµœì†Œí™”)
- ì „ì—­ extent 1íšŒ ê³„ì‚°
- íˆìŠ¤í† ê·¸ë¨ bins ì¡°ì ˆ ê°€ëŠ¥

4.2 Part 3 ì˜ˆê³ 
-----------------------------------------------------------------------------

**ë‹¤ë£° ë‚´ìš©**:
1. **C++ VTK ì¶œë ¥ ì‹œìŠ¤í…œ**
   - src/visualization/ldm_plot_vtk.cu ì™„ì „ ë¶„ì„
   - VTK íŒŒì¼ í¬ë§· êµ¬ì¡°
   - ì…ì ë°ì´í„° â†’ VTK ë³€í™˜
   - í•µì¢…ë³„ íŒŒì¼ ì¶œë ¥
   - enable_vtk_output ì œì–´ ë¡œì§

2. **ë””ë²„ê¹… ë„êµ¬**
   - Memory Doctor ì‹œìŠ¤í…œ
   - Kernel Error Collector
   - ê³µìœ  ë©”ëª¨ë¦¬ ì§„ë‹¨ ë„êµ¬

3. **í†µí•© ë° ìë™í™”**
   - ì‹œë®¬ë ˆì´ì…˜ â†’ ì‹œê°í™” ìë™ íŒŒì´í”„ë¼ì¸
   - cleanup.py í†µí•©
   - Makefile ë¹Œë“œ ì‹œìŠ¤í…œ
   - ì „ì²´ ì›Œí¬í”Œë¡œìš° ìµœì í™”

4. **í–¥í›„ ê°œì„  ë°©í–¥**
   - ì›¹ ê¸°ë°˜ ëŒ€í™”í˜• ì‹œê°í™”
   - ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
   - 3D ì‹œê°í™” (Mayavi/VTK)
   - ë³‘ë ¬ ì²˜ë¦¬ ìµœì í™”

=============================================================================
END OF PART 2
=============================================================================

ì´ ì¤„ ìˆ˜: ~1,000ì¤„
ë‹¤ìŒ: Part 3 (C++ VTK ì¶œë ¥, ë””ë²„ê¹… ë„êµ¬, í†µí•© ë° ìë™í™”)
